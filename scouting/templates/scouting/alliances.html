{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Alliance Selection</title>
  <!-- Bootstrap CSS for styling -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    /* Additional styling if desired */
    .table thead th {
      background-color: #343a40;
      color: #fff;
    }
  </style>
</head>
<body class="bg-light">
  <div class="container my-4">
    <h1 class="mb-4">Alliance Selection</h1>
    <table id="alliancesTable" class="table table-striped">
      <thead>
        <tr>
          <th>Alliance Name</th>
          <th>Picks</th>
          <th>Declines</th>
          <th>Status</th>
          <th>Playoff Avg</th>
          <th>Backup In</th>
          <th>Backup Out</th>
        </tr>
      </thead>
      <tbody>
        <!-- Will be filled by JavaScript -->
      </tbody>
    </table>
  </div>

  <script>
    // Utility function for safely displaying data (replacing empty with '-')
    function safe(val) {
      return val && val !== "" ? val : "-";
    }

    // Load alliances.json and populate the table
    function loadAlliances() {
      $.getJSON("{% static 'json/alliances.json' %}", function(data) {
        const tbody = $("#alliancesTable tbody");
        tbody.empty();

        data.forEach(function(alliance) {
          // alliance is a dict with name, picks, declines, status, playoff_average, backup_in, backup_out
          let row = `
            <tr>
              <td>${safe(alliance.name)}</td>
              <td>${(alliance.picks || []).join(", ") || "-"}</td>
              <td>${(alliance.declines || []).join(", ") || "-"}</td>
              <td>${safe(alliance.status)}</td>
              <td>${safe(alliance.playoff_average)}</td>
              <td>${safe(alliance.backup_in)}</td>
              <td>${safe(alliance.backup_out)}</td>
            </tr>
          `;
          tbody.append(row);
        });
      });
    }

    // Trigger the alliance selection command, then reload the data
    function triggerAllianceSelection(){
      $.get("{% url 'scouting:run_alliance_selection' %}", function(response){
        console.log("Alliance selection triggered:", response);
        // After command finishes, reload alliances
        loadAlliances();
      });
    }

    // Initial load
    loadAlliances();
    // Re-run command every 5 minutes (300,000 ms)
    setInterval(triggerAllianceSelection, 300000);
  </script>
</body>
</html>
